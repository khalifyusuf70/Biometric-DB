<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Military Biometric System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: #2c3e50; color: white; padding: 20px; border-radius: 5px; margin-bottom: 20px; }
        .tabs { display: flex; margin-bottom: 20px; background: white; border-radius: 5px; }
        .tab { padding: 15px 20px; cursor: pointer; border: none; background: none; }
        .tab.active { background: #3498db; color: white; }
        .content { display: none; background: white; padding: 20px; border-radius: 5px; }
        .content.active { display: block; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #3498db; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #2980b9; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; }
        .alert { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .form-section { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🇸🇴 Military Biometric System</h1>
            <p>Soldier Management & Payroll Verification</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('register')">Register Soldier</button>
            <button class="tab" onclick="showTab('soldiers')">View Soldiers</button>
            <button class="tab" onclick="showTab('payroll')">Monthly Payroll</button>
            <button class="tab" onclick="showTab('verify')">Fingerprint Verify</button>
        </div>

        <!-- Register Soldier Tab -->
        <div id="register" class="content active">
            <h2>Register New Soldier</h2>
            <form id="soldierForm">
                <div class="form-section">
                    <h3>Personal Information</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <div class="form-group">
                                <label>Full Names *</label>
                                <input type="text" name="full_names" required>
                            </div>
                            <div class="form-group">
                                <label>Date of Birth *</label>
                                <input type="date" name="date_of_birth" required>
                            </div>
                            <div class="form-group">
                                <label>Gender *</label>
                                <select name="gender" required>
                                    <option value="">Select</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Photo URL</label>
                                <input type="text" name="photo" placeholder="Enter image URL">
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <label>Phone Number *</label>
                                <input type="tel" name="tel_number" pattern="[0-9]{10}" required>
                            </div>
                            <div class="form-group">
                                <label>Clan</label>
                                <input type="text" name="clan">
                            </div>
                            <div class="form-group">
                                <label>Blood Group</label>
                                <select name="blood_group">
                                    <option value="">Select</option>
                                    <option value="A+">A+</option>
                                    <option value="A-">A-</option>
                                    <option value="B+">B+</option>
                                    <option value="B-">B-</option>
                                    <option value="AB+">AB+</option>
                                    <option value="AB-">AB-</option>
                                    <option value="O+">O+</option>
                                    <option value="O-">O-</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Status</label>
                                <select name="status">
                                    <option value="Active">Active</option>
                                    <option value="Wounded">Wounded</option>
                                    <option value="Discharged">Discharged</option>
                                    <option value="Dead">Dead</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Military Information</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <div class="form-group">
                                <label>Rank/Position *</label>
                                <select name="rank_position" required>
                                    <option value="">Select</option>
                                    <option value="Askari">Askari</option>
                                    <option value="Taliye Unug">Taliye Unug</option>
                                    <option value="Taliye Koox">Taliye Koox</option>
                                    <option value="Taliye Horin">Taliye Horin</option>
                                    <option value="Abandule">Abandule</option>
                                    <option value="Taliye Guuto">Taliye Guuto</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Date of Enlistment *</label>
                                <input type="date" name="date_of_enlistment" required>
                            </div>
                            <div class="form-group">
                                <label>Horin/Platoon *</label>
                                <select name="horin_platoon" required>
                                    <option value="">Select</option>
                                    <option value="Horin1">Horin1</option>
                                    <option value="Horin2">Horin2</option>
                                    <option value="Horin3">Horin3</option>
                                    <option value="Horin4">Horin4</option>
                                    <option value="Horin5">Horin5</option>
                                    <option value="Taliska">Taliska</option>
                                    <option value="Fiat">Fiat</option>
                                    <option value="Gaadidka">Gaadidka</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <label>Horin/Platoon Commander *</label>
                                <input type="text" name="horin_commander" required placeholder="Commander's full name">
                            </div>
                            <div class="form-group">
                                <label>Net Salary *</label>
                                <input type="number" name="net_salary" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label>Fingerprint Data</label>
                                <textarea name="fingerprint_data" rows="3" placeholder="Paste fingerprint template data here"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Guarantor Information</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Guarantor Name *</label>
                            <input type="text" name="guarantor_name" required>
                        </div>
                        <div class="form-group">
                            <label>Guarantor Phone *</label>
                            <input type="tel" name="guarantor_phone" pattern="[0-9]{10}" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Emergency Contact</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Emergency Contact Name *</label>
                            <input type="text" name="emergency_contact_name" required>
                        </div>
                        <div class="form-group">
                            <label>Emergency Contact Phone *</label>
                            <input type="tel" name="emergency_contact_phone" pattern="[0-9]{10}" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Additional Information</h3>
                    <div class="form-group">
                        <label>Home Address</label>
                        <textarea name="home_address" rows="3" placeholder="Full home address"></textarea>
                    </div>
                </div>

                <button type="submit">Register Soldier</button>
            </form>
            <div id="formMessage"></div>
        </div>

        <!-- View Soldiers Tab -->
        <div id="soldiers" class="content">
            <h2>All Soldiers</h2>
            <button onclick="loadSoldiers()">Refresh List</button>
            <div id="soldiersList"></div>
        </div>

        <!-- Monthly Payroll Tab -->
        <div id="payroll" class="content">
            <h2>Monthly Payroll Report</h2>
            <div class="form-group">
                <label>Month</label>
                <input type="number" id="payrollMonth" min="1" max="12" value="10">
            </div>
            <div class="form-group">
                <label>Year</label>
                <input type="number" id="payrollYear" value="2025">
            </div>
            <button onclick="generatePayroll()">Generate Report</button>
            <div id="payrollReport"></div>
        </div>

        <!-- Fingerprint Verify Tab -->
        <div id="verify" class="content">
            <h2>Fingerprint Verification</h2>
            <div class="form-group">
                <label>Fingerprint Template (Simulated)</label>
                <input type="text" id="fingerprintInput" placeholder="Enter fingerprint data">
            </div>
            <button onclick="verifyFingerprint()">Verify Fingerprint</button>
            <div id="verificationResult"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://biometric-db.onrender.com';

        function showTab(tabName) {
            document.querySelectorAll('.content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Register Soldier
        document.getElementById('soldierForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);

            try {
                const response = await fetch(`${API_BASE}/soldiers`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                const messageDiv = document.getElementById('formMessage');
                if (result.success) {
                    messageDiv.innerHTML = `<div class="alert success">Soldier registered successfully! ID: ${result.soldier.soldier_id}</div>`;
                    e.target.reset();
                } else {
                    messageDiv.innerHTML = `<div class="alert error">Error: ${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('formMessage').innerHTML = `<div class="alert error">Network error: ${error.message}</div>`;
            }
        });

        // Load Soldiers
        async function loadSoldiers() {
            try {
                const response = await fetch(`${API_BASE}/soldiers`);
                const result = await response.json();
                
                if (result.success) {
                    const soldiersHtml = `
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Rank</th>
                                    <th>Platoon</th>
                                    <th>Commander</th>
                                    <th>Salary</th>
                                    <th>Status</th>
                                    <th>Phone</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${result.soldiers.map(soldier => `
                                    <tr>
                                        <td><strong>${soldier.soldier_id}</strong></td>
                                        <td>${soldier.full_names}</td>
                                        <td>${soldier.rank_position}</td>
                                        <td>${soldier.horin_platoon}</td>
                                        <td>${soldier.horin_commander || 'N/A'}</td>
                                        <td>$${soldier.net_salary}</td>
                                        <td>${soldier.status}</td>
                                        <td>${soldier.tel_number}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    document.getElementById('soldiersList').innerHTML = soldiersHtml;
                }
            } catch (error) {
                document.getElementById('soldiersList').innerHTML = `<div class="alert error">Error loading soldiers: ${error.message}</div>`;
            }
        }

        // Generate Payroll
        async function generatePayroll() {
            const month = document.getElementById('payrollMonth').value;
            const year = document.getElementById('payrollYear').value;
            
            try {
                const response = await fetch(`${API_BASE}/monthly-payroll?month=${month}&year=${year}`);
                const result = await response.json();
                
                if (result.success) {
                    const report = result.report;
                    const payrollHtml = `
                        <div class="alert success">
                            <h3>Payroll Report - ${report.month}/${report.year}</h3>
                            <p>Total Soldiers: ${report.total_soldiers} | Total Salary: $${report.total_salary}</p>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Rank</th>
                                    <th>Platoon</th>
                                    <th>Salary</th>
                                    <th>Verified At</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${report.soldiers.map(soldier => `
                                    <tr>
                                        <td>${soldier.soldier_id}</td>
                                        <td>${soldier.full_names}</td>
                                        <td>${soldier.rank_position}</td>
                                        <td>${soldier.horin_platoon}</td>
                                        <td>$${soldier.net_salary}</td>
                                        <td>${new Date(soldier.verified_at).toLocaleDateString()}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    document.getElementById('payrollReport').innerHTML = payrollHtml;
                }
            } catch (error) {
                document.getElementById('payrollReport').innerHTML = `<div class="alert error">Error generating payroll: ${error.message}</div>`;
            }
        }

        // Verify Fingerprint
        async function verifyFingerprint() {
            const fingerprint = document.getElementById('fingerprintInput').value;
            
            if (!fingerprint) {
                alert('Please enter fingerprint data');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/verify-fingerprint`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ fingerprint_template: fingerprint })
                });

                const result = await response.json();
                const resultDiv = document.getElementById('verificationResult');
                
                if (result.success) {
                    resultDiv.innerHTML = `
                        <div class="alert success">
                            <h3>✅ Verification Successful!</h3>
                            <p><strong>Soldier:</strong> ${result.soldier.full_names}</p>
                            <p><strong>ID:</strong> ${result.soldier.soldier_id}</p>
                            <p><strong>Rank:</strong> ${result.soldier.rank_position}</p>
                            <p><strong>Platoon:</strong> ${result.soldier.horin_platoon}</p>
                            <p><strong>Salary:</strong> $${result.soldier.net_salary}</p>
                            <p><strong>Time:</strong> ${new Date(result.soldier.verified_at).toLocaleString()}</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="alert error">❌ ${result.message}</div>`;
                }
            } catch (error) {
                document.getElementById('verificationResult').innerHTML = `<div class="alert error">Network error: ${error.message}</div>`;
            }
        }

        // Load soldiers when tab is shown
        document.querySelector('[onclick="showTab(\'soldiers\')"]').addEventListener('click', loadSoldiers);
    </script>
</body>
</html>
