    <script>
        const API_BASE = 'https://biometric-db.onrender.com';
        let photoBase64 = '';

        console.log('API Base URL:', API_BASE);

        // Test connection on load
        fetch(`${API_BASE}/health`)
          .then(r => r.text())
          .then(text => {
              console.log('Health check raw response:', text);
              try {
                  const json = JSON.parse(text);
                  console.log('Health check JSON:', json);
              } catch (e) {
                  console.log('Health check NOT JSON - this is the problem!');
              }
          })
          .catch(err => {
              console.log('Health check failed:', err);
          });

        // Password Protection
        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            if (password === 'Jubaland2024') { 
                document.getElementById('loginOverlay').style.display = 'none';
            } else {
                alert('❌ Incorrect password! Access denied.');
                document.getElementById('passwordInput').value = '';
            }
        }
        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });

        function showTab(tabName) {
            document.querySelectorAll('.content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Auto-fill Horin Commander based on Platoon selection
        function updateCommander() {
            const platoon = document.querySelector('[name="horin_platoon"]').value;
            const commanders = {
                'Horin1': 'Mohamed Abdi yusuf',
                'Horin2': 'Moge Hussein Guled', 
                'Horin3': 'Weli Fatule',
                'Horin4': 'Hareri Kulow Keynan',
                'Horin5': 'Blank1',
                'Horin6': 'Gowracdiid',
                'Taliska': 'Gowracdiid',
                'Fiat': 'Hiis Abdi Ali'
            };
            
            document.getElementById('horin_commander').value = commanders[platoon] || '';
        }

        // Auto-fill Salary based on Rank selection
        function updateSalary() {
            const rank = document.querySelector('[name="rank_position"]').value;
            const salaries = {
                'Askari': '200',
                'Taliye Unug': '250', 
                'Taliye Koox': '300',
                'Taliye Horin': '350',
                'Abandule': '450',
                'Taliye Guuto': '500'
            };
            
            document.getElementById('net_salary').value = salaries[rank] || '';
        }

        // Photo Upload Functionality
        function previewPhoto(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 2 * 1024 * 1024) {
                    alert('File size too large! Please select an image under 2MB.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('photoPreview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    document.querySelector('.upload-icon').style.display = 'none';
                    photoBase64 = e.target.result;
                }
                reader.readAsDataURL(file);
            }
        }

        // Register Soldier with Debug
        document.getElementById('soldierForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            console.log('Form submitted - starting registration...');
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            data.photo = photoBase64;

            console.log('Form data being sent:', data);

            try {
                console.log('Sending request to:', `${API_BASE}/soldiers`);
                
                const response = await fetch(`${API_BASE}/soldiers`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                console.log('Response status:', response.status);
                const responseText = await response.text();
                console.log('Raw response:', responseText);

                // Try to parse as JSON
                let result;
                try {
                    result = JSON.parse(responseText);
                    console.log('Parsed JSON result:', result);
                } catch (parseError) {
                    console.error('Failed to parse JSON:', parseError);
                    throw new Error(`Server returned non-JSON: ${responseText.substring(0, 100)}...`);
                }

                const messageDiv = document.getElementById('formMessage');
                if (result.success) {
                    messageDiv.innerHTML = `<div class="alert success">✅ Soldier registered successfully! ID: ${result.soldier.soldier_id}</div>`;
                    e.target.reset();
                    document.getElementById('photoPreview').style.display = 'none';
                    document.querySelector('.upload-icon').style.display = 'block';
                    photoBase64 = '';
                } else {
                    messageDiv.innerHTML = `<div class="alert error">❌ Error: ${result.error}</div>`;
                }
            } catch (error) {
                console.error('Registration failed:', error);
                document.getElementById('formMessage').innerHTML = 
                    `<div class="alert error">❌ Registration failed: ${error.message}. Check browser console for details.</div>`;
            }
        });

        // Load Soldiers with Debug
        async function loadSoldiers() {
            console.log('Loading soldiers from:', `${API_BASE}/soldiers`);
            
            try {
                const response = await fetch(`${API_BASE}/soldiers`);
                const responseText = await response.text();
                console.log('Soldiers raw response:', responseText);
                
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('Failed to parse soldiers JSON:', parseError);
                    throw new Error(`Server returned non-JSON: ${responseText.substring(0, 100)}...`);
                }
                
                if (result.success) {
                    const soldiersHtml = `
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Rank</th>
                                    <th>Platoon</th>
                                    <th>Commander</th>
                                    <th>Salary</th>
                                    <th>Status</th>
                                    <th>Phone</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${result.soldiers.map(soldier => `
                                    <tr>
                                        <td><strong>${soldier.soldier_id}</strong></td>
                                        <td>${soldier.full_names}</td>
                                        <td>${soldier.rank_position}</td>
                                        <td>${soldier.horin_platoon}</td>
                                        <td>${soldier.horin_commander || 'N/A'}</td>
                                        <td>$${soldier.net_salary}</td>
                                        <td>${soldier.status}</td>
                                        <td>${soldier.tel_number}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    document.getElementById('soldiersList').innerHTML = soldiersHtml;
                } else {
                    document.getElementById('soldiersList').innerHTML = `<div class="alert error">Error: ${result.error}</div>`;
                }
            } catch (error) {
                console.error('Load soldiers failed:', error);
                document.getElementById('soldiersList').innerHTML = 
                    `<div class="alert error">❌ Failed to load soldiers: ${error.message}. Check browser console.</div>`;
            }
        }

        // Manual Verification with Debug
        async function manualVerification() {
            const soldierId = document.getElementById('manualSoldierId').value.trim();
            
            if (!soldierId) {
                alert('Please enter Soldier ID');
                return;
            }

            console.log('Manual verification for:', soldierId);

            try {
                const response = await fetch(`${API_BASE}/manual-verification`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ soldier_id: soldierId })
                });

                const responseText = await response.text();
                console.log('Manual verification raw response:', responseText);
                
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (parseError) {
                    throw new Error(`Server returned non-JSON: ${responseText.substring(0, 100)}...`);
                }

                if (result.success) {
                    document.getElementById('manualResult').innerHTML = 
                        `<div class="alert success">✅ ${result.message}<br>
                         Soldier: ${result.soldier.full_names}<br>
                         Time: ${new Date(result.soldier.verified_at).toLocaleString()}</div>`;
                    document.getElementById('manualSoldierId').value = '';
                } else {
                    document.getElementById('manualResult').innerHTML = 
                        `<div class="alert error">❌ ${result.error}</div>`;
                }
            } catch (error) {
                console.error('Manual verification failed:', error);
                document.getElementById('manualResult').innerHTML = 
                    `<div class="alert error">❌ Failed: ${error.message}. Check browser console.</div>`;
            }
        }

        // Load Today's Report with Debug
        async function loadTodayReport() {
            console.log('Loading today report from:', `${API_BASE}/today-verifications`);
            
            try {
                const response = await fetch(`${API_BASE}/today-verifications`);
                const responseText = await response.text();
                console.log('Today report raw response:', responseText);
                
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (parseError) {
                    throw new Error(`Server returned non-JSON: ${responseText.substring(0, 100)}...`);
                }
                
                if (result.success) {
                    let html = `<div class="alert info">`;
                    html += `<h4>📊 Daily Report - ${result.date}</h4>`;
                    html += `<p><strong>Total Soldiers:</strong> ${result.summary.total_soldiers}</p>`;
                    html += `<p><strong>Verified Today:</strong> ${result.summary.verified_today}</p>`;
                    html += `<p><strong>Missing Verification:</strong> ${result.summary.missing_verification}</p>`;
                    html += `</div>`;
                    
                    if (result.verifications.length > 0) {
                        html += `<table><tr><th>Soldier ID</th><th>Name</th><th>Rank</th><th>Platoon</th><th>Verification Time</th></tr>`;
                        result.verifications.forEach(verification => {
                            html += `<tr>
                                <td>${verification.soldier_id}</td>
                                <td>${verification.full_names}</td>
                                <td>${verification.rank_position}</td>
                                <td>${verification.horin_platoon}</td>
                                <td>${new Date(verification.verified_at).toLocaleString()}</td>
                            </tr>`;
                        });
                        html += `</table>`;
                    } else {
                        html += `<p>No verifications recorded for today.</p>`;
                    }
                    
                    document.getElementById('todayReport').innerHTML = html;
                }
            } catch (error) {
                console.error('Load today report failed:', error);
                document.getElementById('todayReport').innerHTML = 
                    `<div class="alert error">❌ Failed to load report: ${error.message}. Check browser console.</div>`;
            }
        }

        // Generate Payroll with Debug
        async function generatePayroll() {
            const month = document.getElementById('payrollMonth').value;
            const year = document.getElementById('payrollYear').value;
            
            console.log('Generating payroll for:', month, year);
            
            try {
                const response = await fetch(`${API_BASE}/monthly-payroll?month=${month}&year=${year}`);
                const responseText = await response.text();
                console.log('Payroll raw response:', responseText);
                
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (parseError) {
                    throw new Error(`Server returned non-JSON: ${responseText.substring(0, 100)}...`);
                }
                
                if (result.success) {
                    const report = result.report;
                    const payrollHtml = `
                        <div class="alert success">
                            <h3>Payroll Report - ${report.month}/${report.year}</h3>
                            <p>Total Soldiers: ${report.total_soldiers} | Total Salary: $${report.total_salary}</p>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Rank</th>
                                    <th>Platoon</th>
                                    <th>Salary</th>
                                    <th>Verified At</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${report.soldiers.map(soldier => `
                                    <tr>
                                        <td>${soldier.soldier_id}</td>
                                        <td>${soldier.full_names}</td>
                                        <td>${soldier.rank_position}</td>
                                        <td>${soldier.horin_platoon}</td>
                                        <td>$${soldier.net_salary}</td>
                                        <td>${new Date(soldier.verified_at).toLocaleDateString()}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    document.getElementById('payrollReport').innerHTML = payrollHtml;
                } else {
                    document.getElementById('payrollReport').innerHTML = `<div class="alert error">Error: ${result.error}</div>`;
                }
            } catch (error) {
                console.error('Generate payroll failed:', error);
                document.getElementById('payrollReport').innerHTML = 
                    `<div class="alert error">❌ Failed to generate payroll: ${error.message}. Check browser console.</div>`;
            }
        }

        // Load soldiers when tab is shown
        document.querySelector('[onclick="showTab(\'soldiers\')"]').addEventListener('click', loadSoldiers);
        // Load today's report when tab is shown
        document.querySelector('[onclick="showTab(\'verification\')"]').addEventListener('click', loadTodayReport);
    </script>
